#+TITLE: minimal_proxy/gen

* rsync
#+begin_example zsh
rsp-safe ~/scripts/setup/minimal_proxy/.shared.sh x@y:
rsp-safe ~/.tmux.conf ~/.inputrc x@y:

rsp-safe ~/.tmux.conf ~/.inputrc ~/scripts/setup/minimal_proxy/*.(zsh|zshenv|zshrc|bashrc|bash|sh)(D) x@y:
#+end_example

* Add User
:PROPERTIES:
:visibility: folded
:END:
#+begin_example zsh
function sudoer-add-user {
  local user="${1:?}"
  sudo perl - "$user" << 'EOF'
use strict;
use warnings;
use File::Temp 'tempfile';

# Get the user from command line arguments
my $user = $ARGV[0];

# Path to the sudoers file
my $sudoers_file = '/etc/sudoers';

# The line to add
my $line_to_add = "$user ALL=(ALL:ALL) ALL";

# Create a temporary file
my ($fh, $filename) = tempfile();

# Open the sudoers file
open my $in, '<', $sudoers_file or die $!;

# Flag to check if the line is already in the file
my $found = 0;

while (<$in>) {
    # If the line is found, set the flag
    if ($_ =~ /^$line_to_add$/) {
        $found = 1;
    }

    # Write the line to the temporary file
    print $fh $_;
}

# If the line was not found, add it
if (not $found) {
    print $fh "$line_to_add\n";
}

close $in;
close $fh;

# Use visudo to check and move the file
system("visudo -c -f $filename") == 0 or die $!;

# If the check was successful, replace the sudoers file
rename $filename, $sudoers_file or die $!;
EOF
}
#+end_example


* install
** [[id:7be66ef4-f0a4-49c9-9d61-fce8ead929c2][zsh/install]]

** [[id:6de074b1-51c0-4282-9dac-4056c60978c8][starship/starship: ‚òÑüååÔ∏è The minimal, blazing-fast, and infinitely customizable prompt for any shell!]]

** [[id:d139edf6-3aa9-46fb-8da3-3c68eb3885a5][ajeetdsouza/zoxide: A smarter cd command. Supports all major shells.]]

** [[id:4290bea9-23d5-4359-84e1-4e0d091ebad6][@install micromamba]]

** [[id:3eed54eb-4ff0-4c77-8d87-7ade88f9fdb4][@install gost]]

* [[id:cef1b558-0642-4d7e-b94b-b357e2e6bf48][Adding a new SSH key to your GitHub account - GitHub Docs]]

* [[https://github.com/webinstall/webi-installers][webinstall/webi-installers: Primary and community-submitted packages for webinstall.dev]]
** [[https://github.com/webinstall/webi-installer-requests/issues?q=+sort%3Aupdated-desc+author%3ANightMachinery+][Issues ¬∑ webinstall/webi-installer-requests]]

** setting up the PATH for =webi= installed binaries
#+begin_example zsh
source ~/.config/envman/PATH.env
#+end_example

** others
#+begin_example zsh
curl -sS https://webi.sh/webi | sh

curl -sS https://webi.sh/golang | sh
curl -sS https://webi.sh/go-essentials | sh

curl -sS https://webi.sh/ffmpeg | sh

curl -sS https://webi.sh/gh | sh
curl -sS https://webi.sh/rg | sh
curl -sS https://webi.sh/fd | sh
curl -sS https://webi.sh/fzf | sh
curl -sS https://webi.sh/jq | sh

# curl -sS https://webi.sh/docker | sh # NA
#+end_example

** pip
#+begin_example zsh
pip install --upgrade pipx
pipx install -U speedtest-cli nvitop

pip install -U jupyter jupyterlab
#+end_example

** apt
#+begin_example zsh
sudo apt-get install -y tmux zsh openconnect jq python3 python3-pip
#+end_example

** brew
#+begin_example zsh
curl -sS https://webi.sh/brew | sh
#+end_example

Or:
#+begin_example zsh
tmuxnew brew-install zsh -c 'curl -sS https://webi.sh/brew | sh'
#+end_example

*** PATH
#+begin_example zsh
export PATH="${PATH}:${HOME}/.local/opt/brew/bin"
#+end_example

*** install
#+begin_example zsh
brew install zsh tealdeer progress bandwhich ncdu rm-improved
#+end_example

* Caddy
#+begin_example zsh
tmux new -d -s 'serve-dl-caddy' caddy run --config ~/Caddyfile
#+end_example

#+begin_src bsh.dash :results verbatim :exports both :wrap results
reval-ec rsp-safe Caddyfile ubuntu@185.235.42.146:
#+end_src

#+RESULTS:
#+begin_results
rsp-safe Caddyfile ubuntu@185.235.42.146:

            306 100%    0.00kB/s    0:00:00
            306 100%    0.00kB/s    0:00:00 (xfr#1, to-chk=0/1)
            306 100%    0.00kB/s    0:00:00 (xfr#1, to-chk=0/1)
#+end_results

* v2ray
#+begin_example zsh
tmux new -d -s v2ray v2ray -config /usr/local/etc/v2ray/config.json
#+end_example

#+begin_example zsh
sudo cp ~/v2_server.json /usr/local/etc/v2ray/config.json
#+end_example

#+begin_src bsh.dash :results verbatim :exports both :wrap results
# reval-ec rsp-safe ./*.json ubuntu@185.235.42.146:
#+end_src


* borg
#+begin_example zsh
mkdir -p ~/code/
cd ~/code/
# git clone git@github.com:NightMachinery/betterborg.git
git clone https://github.com/NightMachinery/betterborg.git

cd betterborg
pip install -r requirements.txt 
#+end_example

#+begin_example zsh
tmuxnew julia-borg bash -c 'cd ~/code/betterborg/ && borgp=1096 python3 stdborg.py'
#+end_example

* Zsh
** escape codes for hotkeys
*** Make Zsh understand that =^[[1;3C= means =alt + right arrow=.
